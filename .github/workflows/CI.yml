name: CI
on:
  pull_request: 
    branches: [ main, gui ]

jobs:
  build:
    runs-on: windows-latest    
    strategy:
      matrix:
        os: [windows-latest ubuntu-latest]
    steps:
      - name: Checkout this repo
        uses: actions/checkout@v2
        with:
          token: ${{secrets.GLFW_CHECKOUT}}
          submodules: recursive
      - name: Checkout submodules
          run: |
            cd src/extern/glfw
            git checkout master
            cd ../imgui
            git checkout master
            cd ../../..
      - name: Use Bazel (Windows only)
        if: matrix.os == 'windows'
        run: |
          dir "C:\Program Files (x86)"
          cd src
          ./bazel.exe build :rebosdk
      - name: Use Bazel
        if: matrix.os != 'windows'
        run: |
          cd src
          bazel build :rebosdk
